L.Control.GroupedLayers=L.Control.extend({options:{collapsed:!0,position:"topright",autoZIndex:!0,exclusiveGroups:[],groupCheckboxes:!1},initialize:function(controlGroups,options){var i,j;for(i in L.Util.setOptions(this,options),this._ctrls=[],this._groupList=[],this._domGroups=[],this._selectCtrls={},this._subsetChanged=!0,this._optionClicked=!1,this._lastSelectedRadio="",this._lastSelect=void 0,this._lastSelectedOption="",controlGroups){if(type=controlGroups[i].type,"simpleControl"==type)for(j in controlGroups[i])"defaultFilter"!=j&&"propertyName"!=j&&"type"!=j&&"defaultSubset"!=j&&this._addControl(controlGroups[i][j],j,i,controlGroups[i].defaultFilter,!0,type);"selectControl"==type&&this._addControl(controlGroups[i].defaultSubset,controlGroups[i].name,controlGroups[i].group,controlGroups[i].defaultFilter,!0,type,controlGroups[i].values)}},onAdd:function(map){return this._initLayout(map),this._update(),this._container},onRemove:function(map){},_getControlById:function(id){for(var i=0;i<this._ctrls.length;i++)if(this._ctrls[i]&&this._ctrls[i].ctrlId===id)return this._ctrls[i]},_getControlByName:function(name){for(var i=0;i<this._ctrls.length;i++)if(this._ctrls[i]&&this._ctrls[i].acronym.includes(name))return this._ctrls[i]},_initLayout:function(map){var className="leaflet-control-layers",container=this._container=L.DomUtil.create("div",className);container.setAttribute("aria-haspopup",!0),$(container).mouseenter((function(){map.dragging.disable(),map.scrollWheelZoom.disable(),map.doubleClickZoom.disable()})),$(container).mouseleave((function(){map.dragging.enable(),map.scrollWheelZoom.enable(),map.doubleClickZoom.enable()})),L.Browser.touch?L.DomEvent.on(container,"click",L.DomEvent.stopPropagation):(L.DomEvent.disableClickPropagation(container),L.DomEvent.on(container,"wheel",L.DomEvent.stopPropagation));var form=this._form=L.DomUtil.create("form",className+"-list");if(this._baseLayersList=L.DomUtil.create("div",className+"-base",form),this._separator=L.DomUtil.create("div",className+"-separator",form),this._overlaysList=L.DomUtil.create("div",className+"-overlays",form),this._landUseItens=L.DomUtil.create("div","landuse-itens"),container.appendChild(form),this.options.collapsed){L.Browser.android||L.DomEvent.on(container,"mouseover",this._expand,this).on(container,"mouseout",this._collapse,this);var link=this._layersLink=L.DomUtil.create("a",className+"-toggle",container);link.href="#",link.title="Layers",L.Browser.touch?L.DomEvent.on(link,"click",L.DomEvent.stop).on(link,"click",this._expand,this):L.DomEvent.on(link,"focus",this._expand,this),this._map.on("click",this._collapse,this)}else this._expand()},_addControl:function(acronym,name,group,defaultFilter,overlay,type,values){var _ctrl={acronym:acronym,name:name,defaultFilter:defaultFilter,overlay:overlay,type:type,values:values||[]};_ctrl.ctrlId=L.Util.stamp(_ctrl),this._ctrls.push(_ctrl),group=group||"";var groupId=this._indexOf(this._groupList,group);-1===groupId&&(groupId=this._groupList.push(group)-1);var exclusive=-1!==this._indexOf(this.options.exclusiveGroups,group);_ctrl.group={name:group,id:groupId,exclusive:exclusive}},_update:function(){if(!this._container)return;this._baseLayersList.innerHTML="",this._overlaysList.innerHTML="",this._landUseItens.innerHTML="",this._domGroups.length=0;for(var baseLayersPresent=!1,overlaysPresent=!1,i,obj,i=0;i<this._ctrls.length;i++)"simpleControl"==(obj=this._ctrls[i]).type&&this._addItem(obj),"selectControl"==obj.type&&this._addOptionItem(obj),overlaysPresent=overlaysPresent||obj.overlay,baseLayersPresent=baseLayersPresent||!obj.overlay;let dctrl=this._getDownloadControlDOM();this._overlaysList.appendChild(dctrl),this._separator.style.display=overlaysPresent&&baseLayersPresent?"":"none"},_createInputElement:function(name,type,checked,userDefined,objId){var inputHtml='<input type="'+type+'" class="leaflet-control-layers-selector" name="'+name+'"';objId&&(inputHtml+='id="ctrl'+objId+'"'),checked&&(inputHtml+=' checked="checked"'),userDefined&&(inputHtml+='data-user-defined="'+userDefined+'"'),inputHtml+="/>";var inputFragment=document.createElement("div");return inputFragment.innerHTML=inputHtml,inputFragment.firstChild},_createProfileBiomeButton:function(biome){let bt='<label class="leaflet-control-layers-group-name"><button title="Visualize o perfil para todo o recorte." class="btn btn-primary-p profile-bt" id="profile-button"><i class="material-icons profile-bt-icon">leaderboard</i>Perfil</button></label>';var btFragment=document.createElement("div");return btFragment.innerHTML=bt,btFragment},_createLandUseButton:function(){let bt='<button title=\'Desmarcar ou marcar todas as categorias.\' class="btn btn-primary-p landuse-bt lu-all-bt" id="all-categories-button"><i class="material-icons profile-bt-icon">check_box</i>Todas</button><button title=\'Aplica filtro com as categorias fundiárias selecionadas.\' class="btn btn-primary-p landuse-bt lu-ft-bt" id="landuse-categories-button"><i class="material-icons profile-bt-icon">filter_alt</i>Aplicar</button>';var btFragment=document.createElement("div");return btFragment.className="landuse",btFragment.innerHTML=bt,btFragment},_createSubsetSelect:function(name){var subset=document.createElement("div");return subset.classname="leaflet-dropdown-menu",subset.innerHTML='<select name="'+name+'-subset-select" class="leaflet-dropdown-select"></select>',subset},_createSubsetSelectOption:function(text,value,selected){var option=document.createElement("option");return option.textContent=text,option.value=value,option.selected=selected,option},_handleRiskSpatialUnit(hide){const obj=this._getControlByName("cs_5km");if(obj){var $label=$(`#ctrl${obj.ctrlId}`).parent();if($label.length&&$label.toggle(!hide),hide&&obj.checked){const obj=this._getControlByName("cs_25km");if(!obj)return;$(`#ctrl${obj.ctrlId}`).click()}}},handleRiskSelection:function(classificationMapGroupId,obj){var mapClassificationElement,mapClassificationElement;obj.name.toLowerCase().includes("risco")&&obj.checked?($("#ctrl"+this._getControlByName("onPeriod").ctrlId).click(),(mapClassificationElement=document.querySelector('[id="leaflet-control-layers-group-'+classificationMapGroupId+'"]')).style.display="none",ams.PeriodHandler.remove(this._map),this._handleRiskSpatialUnit(!0)):((mapClassificationElement=document.querySelector('[id="leaflet-control-layers-group-'+classificationMapGroupId+'"]')).style.display="block",ams.PeriodHandler.init(this._map),this._handleRiskSpatialUnit(!1))},_addOptionItem:function(obj){var label=document.createElement("label"),input,container,checked=obj.acronym==obj.name;checked&&(this._lastSelectedRadio=obj.name);var groupRadioName="leaflet-exclusive-group-layer-"+obj.group.id,name=document.createElement("span");name.innerHTML=" "+obj.name;var input=this._createInputElement(groupRadioName,"radio",checked,obj.name+"-subset-radio");L.DomEvent.on(input,"click",this._onInputClick,this),input.ctrlId=obj.ctrlId,input.groupID=obj.group.id;var selectCtrl=this._selectCtrls[obj.name];if(!selectCtrl){label.className="leaflet-biome-control-item";let div=document.createElement("div");div.appendChild(input),div.appendChild(name),label.appendChild(div),selectCtrl=this._createSubsetSelect(obj.name),this._selectCtrls[obj.name]=selectCtrl,label.appendChild(selectCtrl)}var select=selectCtrl.querySelector("select");L.DomEvent.on(select,"change",this._onSelectChange,this),L.DomEvent.on(select,"click",this._onSelectChange,this),L.DomEvent.on(select,"focus",this._onSelectFocus,this);for(let p of obj.values)select.appendChild(this._createSubsetSelectOption(p,p,p===obj.defaultFilter));if(obj.overlay){container=this._overlaysList;var groupContainer=this._domGroups[obj.group.id];if(!groupContainer){profileContainer=document.createElement("div"),profileBt=this._createProfileBiomeButton(obj.name),profileContainer.appendChild(profileBt),container.appendChild(profileContainer),(groupContainer=document.createElement("div")).className="leaflet-control-layers-group","RECORTE"===obj.group.name&&(groupContainer.className+=" hide-in-municipality-panel"),groupContainer.id="leaflet-control-layers-group-"+obj.group.id,groupContainer.title=this._getTitleByGroup(obj.group.name);var groupLabel=document.createElement("label");groupLabel.className="leaflet-control-layers-group-label";var groupName=document.createElement("span");groupName.className="leaflet-control-layers-group-name",groupName.innerHTML=obj.group.name,groupLabel.appendChild(groupName),groupContainer.appendChild(groupLabel),container.appendChild(groupContainer),this._domGroups[obj.group.id]=groupContainer}container=groupContainer}else container=this._baseLayersList;return container.appendChild(label),label},_addItem:function(obj){var label=document.createElement("label"),input,checked="CATEGORIA FUNDIÁRIA"==obj.group.name?obj.defaultFilter.includes(obj.acronym):obj.acronym.includes(obj.defaultFilter),container,groupRadioName,profileBt=null,type="CATEGORIA FUNDIÁRIA"==obj.group.name?"checkbox":"radio";groupRadioName="leaflet-exclusive-group-layer-"+obj.group.id,(input=this._createInputElement(groupRadioName,type,checked,void 0,obj.ctrlId)).ctrlId=obj.ctrlId,input.groupID=obj.group.id,L.DomEvent.on(input,"click",this._onInputClick,this);var name=document.createElement("span");if(name.innerHTML=" "+obj.name,"CLASSIFICAÇÃO DO MAPA"==obj.group.name?(label.appendChild(input),label.appendChild(name),this.classificationMapGroupId=obj.group.id):"INDICADOR"==obj.group.name?(label.appendChild(input),label.appendChild(name),L.DomEvent.on(input,"click",(function(){this.handleRiskSelection(this.classificationMapGroupId,obj)}),this)):(label.appendChild(input),label.appendChild(name)),obj.overlay){container=this._overlaysList;var groupContainer=this._domGroups[obj.group.id];if(!groupContainer){(groupContainer=document.createElement("div")).className="leaflet-control-layers-group",groupContainer.id="leaflet-control-layers-group-"+obj.group.id,groupContainer.title=this._getTitleByGroup(obj.group.name),"UNIDADE TEMPORAL"==obj.group.name&&(groupContainer.style="display:none;"),"CATEGORIA FUNDIÁRIA"==obj.group.name&&(groupContainer.className="leaflet-control-layers-group lclg-landuse");var groupLabel=document.createElement("label");groupLabel.className="leaflet-control-layers-group-label","CATEGORIA FUNDIÁRIA"==obj.group.name&&(groupLabel.style="border-top-right-radius: unset; background-color: #dae9c5;");var groupName=document.createElement("span");if(groupName.className="leaflet-control-layers-group-name","CATEGORIA FUNDIÁRIA"==obj.group.name&&(groupName.style="color: #3e3e3e;"),groupName.innerHTML=obj.group.name,groupLabel.appendChild(groupName),groupContainer.appendChild(groupLabel),"CATEGORIA FUNDIÁRIA"==obj.group.name){var groupIcon=document.createElement("i");groupIcon.className="material-icons iconlanduse-updown",groupIcon.innerText="arrow_drop_down",groupContainer.appendChild(groupIcon)}if(container.appendChild(groupContainer),"UNIDADE ESPACIAL"==obj.group.name){let pctrl=this._getPriorityControlDOM();container.appendChild(pctrl)}if("CATEGORIA FUNDIÁRIA"==obj.group.name){this._landUseItens.id="landuse-itens",this._landUseItens.title=this._getTitleByGroup(obj.group.name+"_info");let landUseBt=this._createLandUseButton();this._landUseItens.appendChild(landUseBt);let innerDiv=document.createElement("div");innerDiv.id="ckb-itens",this._landUseItens.appendChild(innerDiv),container.appendChild(this._landUseItens),this._landUseItens=innerDiv}this._domGroups[obj.group.id]=groupContainer}container=groupContainer}else container=this._baseLayersList;return"CATEGORIA FUNDIÁRIA"==obj.group.name?this._landUseItens.appendChild(label):container.appendChild(label),label},_getTitleByGroup:function(grpName){let title="";switch(grpName){case"BIOMA":title="Alterna entre as bases de dados dos biomas disponíveis.";break;case"INDICADOR":title="Aplica um filtro com base nas classes dos dados do DETER, focos do Programa Queimadas e Risco sendo:\n";for(let index=0;index<ams.App._appClassGroups.groups.length;index++){const group=ams.App._appClassGroups.groups[index];title+=" - "+group.name+": "+group.classes.join(", ")+";\n"}break;case"UNIDADE ESPACIAL":title="Alterna entre as unidades espaciais disponíveis.";break;case"CATEGORIA FUNDIÁRIA":title="Permite selecionar categorias fundiárias para restringir a apresentação dos dados.";break;case"CATEGORIA FUNDIÁRIA_info":break;case"CLASSIFICAÇÃO DO MAPA":title='A opção "No Período" destaca as unidades espaciais por intervalos de valor, com destaque para os maiores valores absolutos.\n\n',title+='A opção "Diferença Período Anterior" destaca as unidades espaciais por intervalos de valor, considerando a diferença de valor entre o período selecionado e o período anterior.\n',title+=" - Destaque em tons de vermelho indicam aumento do valor no período corrente em relação ao período anterior.\n",title+=" - Destaque em tons de azul indicam diminuição do valor no período corrente em relação ao período anterior.\n";break;case"RECORTE":title="Alterna entre as diferentes formas de visualização dos dados."}return title},_getPriorityControlDOM:function(){let fctrl=document.createElement("div"),title='title="Altera o número de unidades espaciais consideradas na priorização de exibição do mapa.\n';return title+='Irá destacar, com borda vermelha, as unidades espaciais com maior valor agregado para o período." ',fctrl.innerHTML='<div class="leaflet-control-layers-group" id="prioritization-control-layers-group"><label class="leaflet-control-layers-group-name" '+title+'><span class="leaflet-control-layers-group-name">Prioriza&#231;&#227;o </span><input type="number" id="prioritization-input" min="1" style="width:45px" '+title+"value="+ams.App._priorViewParams.limit+' /><button class="btn btn-primary-p" id="prioritization-button" style="margin-left: 10px;"> Ok </button></label></div>',fctrl.firstChild},_getDownloadControlDOM:function(){let fctrl=document.createElement("div"),title='title="O arquivo inclui dados filtrados por: BIOMA, INDICADOR e PERÍODO.\n';title+=" - CSV: inclui todas as unidades espaciais com valores dos indicadores n&#227;o nulos;\n",title+=' - Shapefile: inclui todas as unidades espaciais;" ';let dataName=ams.App._appClassGroups.getGroupName(ams.App._suViewParams.classname);return fctrl.innerHTML='<div class="leaflet-control-layers-group" id="shapezip-control-layers-group"><label class="leaflet-control-layers-group-label"><span class="leaflet-control-layers-group-name">DOWNLOAD</span></label><label class="leaflet-control-layers-group-name" '+title+'><span style="white-space: pre-wrap;">Baixar valores dos indicadores <br>(<span id="dataname-to-download">'+dataName+'</span>).</label><label class="leaflet-control-layers-group-name btn-download"><button class="btn btn-primary-p btn-success" id="csv-download-button"> CSV </button>&nbsp;&nbsp;<button class="btn btn-primary-p btn-success" id="shapezip-download-button"> Shapefile </button></label></div>',fctrl.firstChild},_onInputClick:function(e){var itype,obj,obj;if("selectControl"!==this._getControlById(e.target.ctrlId).type)return(obj=this._getControlById(e.target.ctrlId)).inputtype=e.target.type,obj.checked=e.target.checked,void this._map.fire("changectrl",obj);if((obj=JSON.parse(JSON.stringify(this._getControlById(e.target.ctrlId)))).name!==this._lastSelectedRadio||this._optionClicked){this._optionClicked=!1;var selectCtrl,select=this._selectCtrls[obj.name].querySelector("select");obj.inputtype=e.target.type,obj.checked=e.target.checked,obj.group.name=obj.name.toUpperCase(),obj.subset=obj.name,obj.name=select.value,obj.acronym=select.value,obj.subsetChanged=this._subsetChanged,"customizado"!=obj.name?this._map.fire("changectrl",obj):ams.App._getCustomizedMunicipalities().then(geocodes=>{if(!geocodes.length){var radioName=this._lastSelectedRadio+"-subset-radio",radio;return document.querySelector('input[type="radio"][data-user-defined="'+radioName+'"]').checked=!0,void(this._lastSelect&&this._lastSelect.val(this._lastSelectedOption))}obj.customized=geocodes,this._map.fire("changectrl",obj)})}},_onSelectFocus:function(e){this._lastSelect=$(e.target).closest("select"),this._lastSelectedOption=$(e.target).val()},_onSelectChange:function(e){if("option"!==e.target.tagName.toLowerCase())return!1;var radioName=$(e.target).closest("select").attr("name").replace("-select","-radio"),radio=document.querySelector('input[type="radio"][data-user-defined="'+radioName+'"]');this._subsetChanged=!1,this._optionClicked=!0,radio.click()},_expand:function(){L.DomUtil.addClass(this._container,"leaflet-control-layers-expanded"),L.DomUtil.addClass(this._form,"leaflet-control-layers-scrollbar"),this._form.style.height="auto"},_onWindowResize:function(){var acceptableHeight=$("#map").height()-2*this._container.offsetTop;this._form.scrollHeight>acceptableHeight?this._form.style.height=acceptableHeight+"px":this._form.style.height="auto"},_collapse:function(){this._container.className=this._container.className.replace(" leaflet-control-layers-expanded","")},_indexOf:function(arr,obj){for(var i=0,j=arr.length;i<j;i++)if(arr[i]===obj)return i;return-1}}),L.control.groupedLayers=function(controlGroups,options){return new L.Control.GroupedLayers(controlGroups,options)};